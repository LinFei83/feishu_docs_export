# 飞书应用权限配置指南

本文档详细说明如何在飞书开放平台为应用配置所需的权限。

## 📋 权限清单

应用需要以下权限才能正常工作：

### 必需权限

| 权限名称 | 权限说明 | 必要性 |
|---------|---------|--------|
| `contact:user.employee_id:readonly` | 获取用户 employeeID | **必需** - 用于身份验证和API调用 |
| `docs:doc` | 查看、评论和导出文档 | **必需** - 访问飞书文档 |
| `docs:document.media:download` | 下载文档中的媒体文件 | **必需** - 下载文档中的图片等媒体 |
| `docs:document:export` | 导出文档为其他格式 | **必需** - 导出为PDF、Word等格式 |
| `docx:document` | 访问新版文档 | **必需** - 访问新版飞书文档 |
| `drive:drive` | 查看云盘信息 | **必需** - 浏览云盘结构 |
| `drive:file` | 查看云盘文件 | **必需** - 查看文件列表 |
| `drive:file:download` | 下载云盘文件 | **必需** - 下载文件 |
| `wiki:wiki` | 查看、编辑和管理知识库 | **必需** - 访问知识库 |
| `offline_access` | 获取 refresh token | **必需** - 保持登录状态 |

### 可选权限（推荐）

| 权限名称 | 权限说明 | 用途 |
|---------|---------|-----|
| `bitable:app` | 查看、评论、编辑和管理多维表格 | 支持多维表格导出 |
| `sheets:spreadsheet` | 查看、评论、编辑和管理电子表格 | 支持电子表格导出 |

## 🔧 配置步骤

### 1. 登录飞书开放平台

访问 [飞书开放平台](https://open.feishu.cn/) 并登录您的账号。

### 2. 创建或选择应用

- 如果还没有应用，点击「创建企业自建应用」
- 如果已有应用，在应用列表中选择您的应用

### 3. 配置权限

#### 步骤 A: 进入权限管理页面
1. 在应用管理页面，点击左侧菜单的「权限管理」
2. 或点击「添加应用能力」→「权限配置」

#### 步骤 B: 添加权限
对于上述必需权限列表中的每一项：

1. 在搜索框中输入权限名称（如 `contact:user.employee_id:readonly`）
2. 在搜索结果中找到对应的权限
3. 点击权限卡片右侧的「开通」或「申请」按钮
4. 按照提示完成权限申请流程

> ⚠️ **重要提示**: 某些权限需要管理员审批，请确保及时处理审批流程。

#### 步骤 C: 验证权限配置
1. 返回「权限管理」页面
2. 确认所有必需权限都显示为「已开通」状态
3. 特别确认 `contact:user.employee_id:readonly` 权限已开通（这是最容易遗漏的权限）

### 4. 配置安全设置

#### 重定向 URL 配置
1. 在应用管理页面，点击「安全设置」
2. 在「重定向 URL」部分，添加以下两个 URL：
```
http://localhost:3000/callback
http://localhost:3001/callback
```
3. 点击「保存」

#### IP 白名单（可选）
如果您的企业有 IP 白名单要求，请添加应用运行的 IP 地址。

### 5. 发布应用

1. 完成所有配置后，点击「版本管理与发布」
2. 创建新版本并提交审核
3. 审核通过后，将应用发布到企业

> 💡 **提示**: 企业自建应用通常可以免审核，直接在企业内部使用。

## 🐛 常见问题排查

### 问题 1: 提示"Access denied"错误

**错误信息**:
```
Access denied. One of the following scopes is required: [contact:user.employee_id:readonly]
```

**解决方案**:
1. 检查飞书开放平台后台，确认 `contact:user.employee_id:readonly` 权限已开通
2. 如果权限已开通但仍报错，请尝试以下步骤：
   - 在应用中退出登录
   - 清除浏览器缓存（如使用浏览器版本）
   - 重新进行授权登录

### 问题 2: 某些权限无法开通

**可能原因**:
- 权限需要管理员审批
- 企业版本不支持该权限
- 权限配额已用完

**解决方案**:
1. 联系企业管理员进行权限审批
2. 升级企业飞书版本
3. 向飞书客服申请提升权限配额

### 问题 3: 授权后无法访问文件

**检查项**:
1. 确认用户有权限访问对应的文件或文件夹
2. 确认文件没有被删除或移动
3. 检查应用的权限范围是否覆盖该文件类型

## 📞 获取帮助

如果按照本指南操作后仍然遇到问题，可以：

1. 查看应用的详细错误日志
2. 在 [GitHub Issues](https://github.com/ytcheng/feishu_docs_export/issues) 提交问题
3. 参考[飞书开放平台文档](https://open.feishu.cn/document/)

---

**最后更新**: 2025-12-31
